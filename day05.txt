DB 생성 = college
root에서 DB생성/권한부여 (mysqlUser@localhost)

ERDCloud 사이트에서 ERD 그리기

테이블 생성(외래키 생성) => insert 데이터 넣기
----------------------------------------------------
create table professor(
pr_num int not null,
pr_name varchar(20) not null,
pr_age int not null,
pr_room varchar(45) not null,
pr_state varchar(40) default '재직',
pr_position varchar(40) default '조교수',
primary key(pr_num)
);

create table subject(
su_num int not null,
su_code varchar(20) not null,
su_title varchar(45) not null,
su_point int not null default 0,
su_time int not null default 0,
primary key(su_num)
);

create table student(
st_num int not null,
st_name varchar(20) not null,
st_term int not null default 1,
st_point int not null default 0,
primary key(st_num)
);

create table course(
co_num int not null,
co_pr_num int not null,  
co_su_num int not null,   
co_term int not null default 1,
co_year int not null,
co_timetable varchar(100),
primary key(co_num),
foreign key(co_pr_num) references professor(pr_num), --
foreign key(co_su_num) references subject(su_num) -- 여기서 이 두개는 위에서 미리 만들어 놔야 함.
);

create table guide(
gu_num int not null,
gu_pr_num int not null,
gu_st_num int not null,
gu_year int,
primary key(gu_num),
foreign key(gu_pr_num) references professor(pr_num),
foreign key(gu_st_num) references student(st_num)
);

create table attend(
at_num int not null auto_increment,
at_st_num int not null,
at_co_num int not null,
at_mid int not null default 0,
at_final int not null default 0,
at_hw int not null default 0,
at_attend int not null default 0,
at_score varchar(10),
at_pass varchar(1) default 'f',
at_repetition varchar(1) default 'n',
primary key(at_num),
foreign key(at_st_num) references student(st_num),
foreign key(at_co_num) references course(co_num)
);

insert into student(st_num, st_name,st_term) values
(2020123001,'김영철',1),
(2020123002,'나영희',1),
(2020160001,'강철수',2),
(2020160002,'박철수',2),
(2020456001,'강군',2);

insert into subject values
(1,'msc001','대학수학',3,3),
(2,'com001','컴퓨터개론',2,2),
(3,'com002','운영체제',3,3),
(4,'abc001','디자인이론',2,2),
(5,'abc002','생활영어',2,3);

insert into professor values
(2005789001, '홍길동',60,'B동302호','재직','정교수'),
(2006456001, '박영실',65,'B동301호','안식년','정교수'),
(2010160001, '강길동',55,'A동202호','재직','조교수'),
(2010160002, '김길순',50,'A동301호','재직','조교수'),
(2011123001, '이순신',55,'A동203호','재직','정교수');

insert into course(co_num, co_pr_num, co_su_num, co_term, co_year, co_timetable) values
(1, 2005789001,1,1,2002,'월2a/2b/3a/3b/4a/4b'),
(2, 2010160002,1,2,2002,'월2a/2b/3a/3b/4a/4b'),
(3, 2010160001,2,1,2002,'화1a/1b/2a/2b'),
(4, 2010160001,3,1,2002,'목2a/2b/3a/3b/4a/4b'),
(5, 2011123001,4,2,2002,'화1a/1b/2a/2b'),
(6, 2011123001,5,2,2002,'수1a/1b/2a/2b');

insert into guide(gu_num, gu_pr_num, gu_st_num, gu_year) values
(1, 2010160001,2020160001,2023),
(2, 2010160001,2020160002,2023),
(3, 2011123001,2020123001,2023),
(4, 2011123001,2020123002,2023),
(5, 2010160002,2020456001,2023);

insert into attend(at_st_num, at_co_num) values
(2020123001,1),
(2020123001,2),
(2020123001,3),
(2020123001,4),
(2020123001,5),
(2020123001,6),
(2020123002,1),
(2020123002,2),
(2020123002,3),
(2020123002,4),
(2020123002,5),
(2020160001,1),
(2020160001,2),
(2020160001,3),
(2020160001,4),
(2020160001,5),
(2020160001,6),
(2020160002,1),
(2020160002,2),
(2020160002,3),
(2020160002,4),
(2020160002,5),
(2020160002,6),
(2020456001,1),
(2020456001,2),
(2020456001,3),
(2020456001,4),
(2020456001,5);
​

--외래키 연결이 되어있는 테이블 삭제시 아래의 순서로 이루어 져야 해서 좀 빡세다. 수정은 그냥 해도 됨.
1. 외래키 삭제
alter table 테이블명 drop foreign key 외래키명
1-1. 외래키명 확인
select * from information_schema.table_constraints where table_name = '테이블명';
select * from information_schema.table_constraints where table_name = 'course';
+--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
| CONSTRAINT_CATALOG | CONSTRAINT_SCHEMA | CONSTRAINT_NAME | TABLE_SCHEMA | TABLE_NAME | CONSTRAINT_TYPE | ENFORCED |
+--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
| def                | college           | PRIMARY         | college      | course     | PRIMARY KEY     | YES      |
| def                | college           | course_ibfk_1   | college      | course     | FOREIGN KEY     | YES      |
| def                | college           | course_ibfk_2   | college      | course     | FOREIGN KEY     | YES      |
| def                | school            | PRIMARY         | school       | course     | PRIMARY KEY     | YES      |
+--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+

2. 테이블 제거
drop table 테이블명

3. 테이블 재생성
create table...

4. 외래키 생성
alter table 테이블명 add constraint [제약조건명] foreign key(칼럼명) references [부모테이블명](칼럼명)



mysql> select * from student;
+------------+---------+---------+----------+
| st_num     | st_name | st_term | st_point |
+------------+---------+---------+----------+
| 2020123001 | 김영철  |       1 |        0 |
| 2020123002 | 나영희  |       1 |        0 |
| 2020160001 | 강철수  |       2 |        0 |
| 2020160002 | 박철수  |       2 |        0 |
| 2020456001 | 강군    |       2 |        0 |
+------------+---------+---------+----------+
5 rows in set (0.01 sec)

mysql> select * from professor;
+------------+---------+--------+----------+----------+-------------+
| pr_num     | pr_name | pr_age | pr_room  | pr_state | pr_position |
+------------+---------+--------+----------+----------+-------------+
| 2005789001 | 홍길동  |     60 | B동302호 | 재직     | 정교수      |
| 2006456001 | 박영실  |     65 | B동301호 | 안식년   | 정교수      |
| 2010160001 | 강길동  |     55 | A동202호 | 재직     | 조교수      |
| 2010160002 | 김길순  |     50 | A동301호 | 재직     | 조교수      |
| 2011123001 | 이순신  |     55 | A동203호 | 재직     | 정교수      |
+------------+---------+--------+----------+----------+-------------+
5 rows in set (0.00 sec)

mysql> select * from course;
+--------+------------+-----------+---------+---------+---------------------+
| co_num | co_pr_num  | co_su_num | co_term | co_year | co_timetable        |
+--------+------------+-----------+---------+---------+---------------------+
|      1 | 2005789001 |         1 |       1 |    2002 | 월2a/2b/3a/3b/4a/4b |
|      2 | 2010160002 |         1 |       2 |    2002 | 월2a/2b/3a/3b/4a/4b |
|      3 | 2010160001 |         2 |       1 |    2002 | 화1a/1b/2a/2b       |
|      4 | 2010160001 |         3 |       1 |    2002 | 목2a/2b/3a/3b/4a/4b |
|      5 | 2011123001 |         4 |       2 |    2002 | 화1a/1b/2a/2b       |
|      6 | 2011123001 |         5 |       2 |    2002 | 수1a/1b/2a/2b       |
+--------+------------+-----------+---------+---------+---------------------+
6 rows in set (0.00 sec)

mysql> select * from guide;
+--------+------------+------------+---------+
| gu_num | gu_pr_num  | gu_st_num  | gu_year |
+--------+------------+------------+---------+
|      1 | 2010160001 | 2020160001 |    2023 |
|      2 | 2010160001 | 2020160002 |    2023 |
|      3 | 2011123001 | 2020123001 |    2023 |
|      4 | 2011123001 | 2020123002 |    2023 |
|      5 | 2010160002 | 2020456001 |    2023 |
+--------+------------+------------+---------+
5 rows in set (0.00 sec)

mysql> select * from attend;
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
| at_num | at_st_num  | at_co_num | at_mid | at_final | at_hw | at_attend | at_score | at_pass | at_repetition |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
|      1 | 2020123001 |         1 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      2 | 2020123001 |         2 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      3 | 2020123001 |         3 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      4 | 2020123001 |         4 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      5 | 2020123001 |         5 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      6 | 2020123001 |         6 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      7 | 2020123002 |         1 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      8 | 2020123002 |         2 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|      9 | 2020123002 |         3 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     10 | 2020123002 |         4 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     11 | 2020123002 |         5 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     12 | 2020160001 |         1 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     13 | 2020160001 |         2 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     14 | 2020160001 |         3 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     15 | 2020160001 |         4 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     16 | 2020160001 |         5 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     17 | 2020160001 |         6 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     18 | 2020160002 |         1 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     19 | 2020160002 |         2 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     20 | 2020160002 |         3 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     21 | 2020160002 |         4 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     22 | 2020160002 |         5 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     23 | 2020160002 |         6 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     24 | 2020456001 |         1 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     25 | 2020456001 |         2 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     26 | 2020456001 |         3 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     27 | 2020456001 |         4 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
|     28 | 2020456001 |         5 |      0 |        0 |     0 |         0 | NULL     | f       | n             |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
28 rows in set (0.00 sec)

mysql> select * from subject;
+--------+---------+------------+----------+---------+
| su_num | su_code | su_title   | su_point | su_time |
+--------+---------+------------+----------+---------+
|      1 | msc001  | 대학수학   |        3 |       3 |
|      2 | com001  | 컴퓨터개론 |        2 |       2 |
|      3 | com002  | 운영체제   |        3 |       3 |
|      4 | abc001  | 디자인이론 |        2 |       2 |
|      5 | abc002  | 생활영어   |        2 |       3 |
+--------+---------+------------+----------+---------+
5 rows in set (0.00 sec)

---------------------------------------------------------------------------------------------------
1. 김영철이 수강하는 과목명을 출력
st_name, su_title => 이름(student st), 과목명(subject su)

select st.st_name, su.su_title from student st
join attend a on a.at_st_num = st_num
join course c on c.co_num = a.at_co_num
join subject su on su.su_num = c.co_su_num
where st.st_name = '김영철';
---------------------------------------------------
서브 쿼리 형태
SELECT
st_name, 
(
select su_title from subject s
where s.su_num = c.co_su_num
) as su_title
FROM
student st
join attend a on a.at_st_num = st.st_num
join course c on c.co_num = a.at_co_num
WHERE
st.st_name = '김영철';

+---------+------------+
| st_name | su_title   |
+---------+------------+
| 김영철  | 대학수학   |
| 김영철  | 컴퓨터개론 |
| 김영철  | 운영체제   |
| 김영철  | 디자인이론 |
| 김영철  | 생활영어   |
+---------+------------+

2. 강길동 교수가 지도하는 학생명 출력
select st.st_name as '강길동교수 지도학생'
from guide g
join student st on st.st_num = g.gu_st_num
join professor p on p.pr_num = g.gu_pr_num
where p.pr_name='강길동';

select
(
    select st_name from student st
    where st_num = g.gu_st_num
) as '강길동교수 지도학생'
from
  guide g
  join professor p on p.pr_num = g.gu_pr_num
where
  p.pr_name='강길동';


+---------------------+
| 강길동교수 지도학생 |
+---------------------+
| 강철수              |
| 박철수              |
+---------------------+


3. 대학수학 과목을 수강하는 수강자 명단 출력(중복제거)
select distinct st_name as '대학수학 수강자명단'
from student st
join attend a on a.at_st_num = st.st_num
join course c on c.co_num = a.at_co_num
join subject s on s.su_num = c.co_su_num
where s.su_title ='대학수학';

select distinct 
(
select st_name from student st
where st.st_num = a.at_st_num
) as '대학수학 수강자명단'
from 
  attend a
  join course c on c.co_num = a.at_co_num
  join subject s on s.su_num = c.co_su_num
where s.su_title = '대학수학';

+---------------------+
| 대학수학 수강자명단 |
+---------------------+
| 김영철              |
| 나영희              |
| 강철수              |
| 박철수              |
| 강군                |
+---------------------+

---------------------------------------------------------------
1. at_mid, at_final, at_attend, at_hw 값 업데이트
40 40 10 10


update attend set at_mid=40, at_final=40, at_attend=10, at_hw=9
where at_num in (1,9,15);
update attend set at_mid=38, at_final=35, at_attend=8, at_hw=7
where at_num in (2,4,10,5,6);
update attend set at_mid=30, at_final=28, at_attend=5, at_hw=7
where at_num in (3,11,20, 25, 27);
update attend set at_mid=28, at_final=25, at_attend=6, at_hw=10
where at_num in (12,21,19);
update attend set at_mid=12, at_final=20, at_attend=2, at_hw=6
where at_num in (7,16,24);
update attend set at_mid=25, at_final=19, at_attend=7, at_hw=5
where at_num in (8,13,22);
update attend set at_mid=38, at_final=35, at_attend=7, at_hw=6
where at_num in(23, 26, 14, 17, 18);
update attend set at_mid=12, at_final=20, at_attend=5, at_hw=6
where at_num=28;
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
| at_num | at_st_num  | at_co_num | at_mid | at_final | at_hw | at_attend | at_score | at_pass | at_repetition |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
|      1 | 2020123001 |         1 |     40 |       40 |     9 |        10 | NULL     | f       | n             |
|      2 | 2020123001 |         2 |     38 |       35 |     7 |         8 | NULL     | f       | n             |
|      3 | 2020123001 |         3 |     30 |       28 |     7 |         5 | NULL     | f       | n             |
|      4 | 2020123001 |         4 |     38 |       35 |     7 |         8 | NULL     | f       | n             |
|      5 | 2020123001 |         5 |     38 |       35 |     7 |         8 | NULL     | f       | n             |
|      6 | 2020123001 |         6 |     38 |       35 |     7 |         8 | NULL     | f       | n             |
|      7 | 2020123002 |         1 |     12 |       20 |     6 |         2 | NULL     | f       | n             |
|      8 | 2020123002 |         2 |     25 |       19 |     5 |         7 | NULL     | f       | n             |
|      9 | 2020123002 |         3 |     40 |       40 |     9 |        10 | NULL     | f       | n             |
|     10 | 2020123002 |         4 |     38 |       35 |     7 |         8 | NULL     | f       | n             |
|     11 | 2020123002 |         5 |     30 |       28 |     7 |         5 | NULL     | f       | n             |
|     12 | 2020160001 |         1 |     28 |       25 |    10 |         6 | NULL     | f       | n             |
|     13 | 2020160001 |         2 |     25 |       19 |     5 |         7 | NULL     | f       | n             |
|     14 | 2020160001 |         3 |     38 |       35 |     6 |         7 | NULL     | f       | n             |
|     15 | 2020160001 |         4 |     40 |       40 |     9 |        10 | NULL     | f       | n             |
|     16 | 2020160001 |         5 |     12 |       20 |     6 |         2 | NULL     | f       | n             |
|     17 | 2020160001 |         6 |     38 |       35 |     6 |         7 | NULL     | f       | n             |
|     18 | 2020160002 |         1 |     38 |       35 |     6 |         7 | NULL     | f       | n             |
|     19 | 2020160002 |         2 |     28 |       25 |    10 |         6 | NULL     | f       | n             |
|     20 | 2020160002 |         3 |     30 |       28 |     7 |         5 | NULL     | f       | n             |
|     21 | 2020160002 |         4 |     28 |       25 |    10 |         6 | NULL     | f       | n             |
|     22 | 2020160002 |         5 |     25 |       19 |     5 |         7 | NULL     | f       | n             |
|     23 | 2020160002 |         6 |     38 |       35 |     6 |         7 | NULL     | f       | n             |
|     24 | 2020456001 |         1 |     12 |       20 |     6 |         2 | NULL     | f       | n             |
|     25 | 2020456001 |         2 |     30 |       28 |     7 |         5 | NULL     | f       | n             |
|     26 | 2020456001 |         3 |     38 |       35 |     6 |         7 | NULL     | f       | n             |
|     27 | 2020456001 |         4 |     30 |       28 |     7 |         5 | NULL     | f       | n             |
|     28 | 2020456001 |         5 |     12 |       20 |     6 |         5 | NULL     | f       | n             |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+

2. at_mid + at_final + at_attend + at_hw 합계 값을 이용하여
at_score 업데이트
>= 90A / >=80B / >=70C / >=60 D / F

update attend set at_score=
case 
when at_mid + at_final + at_attend + at_hw >= 90 then 'A'
when at_mid + at_final + at_attend + at_hw >= 80 then 'B'
when at_mid + at_final + at_attend + at_hw >= 70 then 'C'
when at_mid + at_final + at_attend + at_hw >= 60 then 'D'
else 'F'
end;
mysql> select * from attend;
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
| at_num | at_st_num  | at_co_num | at_mid | at_final | at_hw | at_attend | at_score | at_pass | at_repetition |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
|      1 | 2020123001 |         1 |     40 |       40 |     9 |        10 | A        | f       | n             |
|      2 | 2020123001 |         2 |     38 |       35 |     7 |         8 | B        | f       | n             |
|      3 | 2020123001 |         3 |     30 |       28 |     7 |         5 | C        | f       | n             |
|      4 | 2020123001 |         4 |     38 |       35 |     7 |         8 | B        | f       | n             |
|      5 | 2020123001 |         5 |     38 |       35 |     7 |         8 | B        | f       | n             |
|      6 | 2020123001 |         6 |     38 |       35 |     7 |         8 | B        | f       | n             |
|      7 | 2020123002 |         1 |     12 |       20 |     6 |         2 | F        | f       | n             |
|      8 | 2020123002 |         2 |     25 |       19 |     5 |         7 | F        | f       | n             |
|      9 | 2020123002 |         3 |     40 |       40 |     9 |        10 | A        | f       | n             |
|     10 | 2020123002 |         4 |     38 |       35 |     7 |         8 | B        | f       | n             |
|     11 | 2020123002 |         5 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     12 | 2020160001 |         1 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     13 | 2020160001 |         2 |     25 |       19 |     5 |         7 | F        | f       | n             |
|     14 | 2020160001 |         3 |     38 |       35 |     6 |         7 | B        | f       | n             |
|     15 | 2020160001 |         4 |     40 |       40 |     9 |        10 | A        | f       | n             |
|     16 | 2020160001 |         5 |     12 |       20 |     6 |         2 | F        | f       | n             |
|     17 | 2020160001 |         6 |     38 |       35 |     6 |         7 | B        | f       | n             |
|     18 | 2020160002 |         1 |     38 |       35 |     6 |         7 | B        | f       | n             |
|     19 | 2020160002 |         2 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     20 | 2020160002 |         3 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     21 | 2020160002 |         4 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     22 | 2020160002 |         5 |     25 |       19 |     5 |         7 | F        | f       | n             |
|     23 | 2020160002 |         6 |     38 |       35 |     6 |         7 | B        | f       | n             |
|     24 | 2020456001 |         1 |     12 |       20 |     6 |         2 | F        | f       | n             |
|     25 | 2020456001 |         2 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     26 | 2020456001 |         3 |     38 |       35 |     6 |         7 | B        | f       | n             |
|     27 | 2020456001 |         4 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     28 | 2020456001 |         5 |     12 |       20 |     6 |         5 | F        | f       | n             |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+

3. at_pass 값 업데이트 (p/f)
at_score가 A 또는 B이면 p(pass) 아니면 f(fail)
update attend set at_pass=
case 
when at_score = 'A' or at_score='B' then 'p'
else 'f'
end;
mysql> select * from attend;
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
| at_num | at_st_num  | at_co_num | at_mid | at_final | at_hw | at_attend | at_score | at_pass | at_repetition |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
|      1 | 2020123001 |         1 |     40 |       40 |     9 |        10 | A        | p       | n             |
|      2 | 2020123001 |         2 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      3 | 2020123001 |         3 |     30 |       28 |     7 |         5 | C        | f       | n             |
|      4 | 2020123001 |         4 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      5 | 2020123001 |         5 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      6 | 2020123001 |         6 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      7 | 2020123002 |         1 |     12 |       20 |     6 |         2 | F        | f       | n             |
|      8 | 2020123002 |         2 |     25 |       19 |     5 |         7 | F        | f       | n             |
|      9 | 2020123002 |         3 |     40 |       40 |     9 |        10 | A        | p       | n             |
|     10 | 2020123002 |         4 |     38 |       35 |     7 |         8 | B        | p       | n             |
|     11 | 2020123002 |         5 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     12 | 2020160001 |         1 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     13 | 2020160001 |         2 |     25 |       19 |     5 |         7 | F        | f       | n             |
|     14 | 2020160001 |         3 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     15 | 2020160001 |         4 |     40 |       40 |     9 |        10 | A        | p       | n             |
|     16 | 2020160001 |         5 |     12 |       20 |     6 |         2 | F        | f       | n             |
|     17 | 2020160001 |         6 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     18 | 2020160002 |         1 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     19 | 2020160002 |         2 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     20 | 2020160002 |         3 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     21 | 2020160002 |         4 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     22 | 2020160002 |         5 |     25 |       19 |     5 |         7 | F        | f       | n             |
|     23 | 2020160002 |         6 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     24 | 2020456001 |         1 |     12 |       20 |     6 |         2 | F        | f       | n             |
|     25 | 2020456001 |         2 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     26 | 2020456001 |         3 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     27 | 2020456001 |         4 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     28 | 2020456001 |         5 |     12 |       20 |     6 |         5 | F        | f       | n             |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+

4. at_repetition 값 업데이트(y/n)
at_score가 F이거나, at_attend가 3이하인 자료는 y 아니면 n'
update attend set at_repetition =
case when at_score='F' or at_attend<=3 then 'y'
else 'n'
end;
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
| at_num | at_st_num  | at_co_num | at_mid | at_final | at_hw | at_attend | at_score | at_pass | at_repetition |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+
|      1 | 2020123001 |         1 |     40 |       40 |     9 |        10 | A        | p       | n             |
|      2 | 2020123001 |         2 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      3 | 2020123001 |         3 |     30 |       28 |     7 |         5 | C        | f       | n             |
|      4 | 2020123001 |         4 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      5 | 2020123001 |         5 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      6 | 2020123001 |         6 |     38 |       35 |     7 |         8 | B        | p       | n             |
|      7 | 2020123002 |         1 |     12 |       20 |     6 |         2 | F        | f       | y             |
|      8 | 2020123002 |         2 |     25 |       19 |     5 |         7 | F        | f       | y             |
|      9 | 2020123002 |         3 |     40 |       40 |     9 |        10 | A        | p       | n             |
|     10 | 2020123002 |         4 |     38 |       35 |     7 |         8 | B        | p       | n             |
|     11 | 2020123002 |         5 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     12 | 2020160001 |         1 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     13 | 2020160001 |         2 |     25 |       19 |     5 |         7 | F        | f       | y             |
|     14 | 2020160001 |         3 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     15 | 2020160001 |         4 |     40 |       40 |     9 |        10 | A        | p       | n             |
|     16 | 2020160001 |         5 |     12 |       20 |     6 |         2 | F        | f       | y             |
|     17 | 2020160001 |         6 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     18 | 2020160002 |         1 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     19 | 2020160002 |         2 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     20 | 2020160002 |         3 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     21 | 2020160002 |         4 |     28 |       25 |    10 |         6 | D        | f       | n             |
|     22 | 2020160002 |         5 |     25 |       19 |     5 |         7 | F        | f       | y             |
|     23 | 2020160002 |         6 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     24 | 2020456001 |         1 |     12 |       20 |     6 |         2 | F        | f       | y             |
|     25 | 2020456001 |         2 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     26 | 2020456001 |         3 |     38 |       35 |     6 |         7 | B        | p       | n             |
|     27 | 2020456001 |         4 |     30 |       28 |     7 |         5 | C        | f       | n             |
|     28 | 2020456001 |         5 |     12 |       20 |     6 |         5 | F        | f       | y             |
+--------+------------+-----------+--------+----------+-------+-----------+----------+---------+---------------+

----------------------------------------------------
1. 학점별 학생 수 출력 (2002 1학기 자료만 사용)
A B C D E F G 의 학생수
at_score, count(st_score)
조건 co_year = 2002, co_term = 1

SELECT a.at_score as '학점', count(a.at_score) as '인원수'
FROM attend a
join course c
on c.co_num = a.at_co_num
where c.co_year = 2002 and c.co_term = 1
group by a.at_score
order by a.at_score;
-------------------------------------
SELECT a.at_score as '학점', count(a.at_score) as '인원수'
FROM attend a
join 
(select co_num from course where co_year=2002 and co_term=1) as c
on c.co_num = a.at_co_num
group by a.at_score
order by a.at_score;


+------+--------+
| 학점 | 인원수 |
+------+--------+
| A    |      3 |
| B    |      5 |
| C    |      3 |
| D    |      2 |
| F    |      2 |
+------+--------+

2.김영철이 수강하는 과목 출력
1학기 => 대학수학(1) => su_title(co_term)
2학기 => 대학수학(2)
attend, student, subject, course

SELECT concat(su.su_title, '(', c.co_term, ')') as 수강과목
FROM subject su
JOIN course c on c.co_su_num = su.su_num
JOIN attend a on a.at_co_num = c.co_num
JOIN student st on st.st_num = a.at_st_num
WHERE st.st_name = '김영철';

+---------------+
| 수강과목      |
+---------------+
| 대학수학(1)   |
| 대학수학(2)   |
| 컴퓨터개론(1) |
| 운영체제(1)   |
| 디자인이론(2) |
| 생활영어(2)   |
+---------------+

---------------------------
index : 인덱스
데이터 베이스에서 조회할 때 결과를 빠르게 추출하도록 도와주는 키
기본키가 아닌 일반 키에 대해 조회를 많이 하면, 
인덱스 추가를 고려해 볼 수 있음.
- 추가적인 DB공간이 필요 (10%)
- 변경작업(insert, update, delete)이 빈번히 일어난다면 성능 저하를 불러올 수 있음.

--------------------------------------
student 테이블에 st_name에 인덱스 추가
--create index 인덱스명 on 테이블명(칼럼명);

create index idx_name on student(st_name);
mysql> desc student;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| st_num   | int         | NO   | PRI | NULL    |       |
| st_name  | varchar(20) | NO   | MUL | NULL    |       |
| st_term  | int         | NO   |     | 1       |       |
| st_point | int         | NO   |     | 0       |       |
+----------+-------------+------+-----+---------+-------+
--st_name에 MUL생김

alter table student drop index idx_name;
mysql> desc student;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| st_num   | int         | NO   | PRI | NULL    |       |
| st_name  | varchar(20) | NO   |     | NULL    |       |
| st_term  | int         | NO   |     | 1       |       |
| st_point | int         | NO   |     | 0       |       |
+----------+-------------+------+-----+---------+-------+
--MUL사라진 거 확인할 수 있음.

------------------------------------------
view 생성
가상테이블
create view view_name as
(서브쿼리로 뷰 내용 검색)

1. 1학기 수업을 듣는 학생명단  1_term_view
학번, 이름  조건 1학기 수강자 co_term = 1
중복제거
create view 1_term_view as
select distinct st_num, st_name
from student s
join attend a on a.at_st_num = s.st_num
join course c on a.at_co_num = c.co_num
where c.co_term = 1;

mysql> select * from 1_term_view;
+------------+---------+
| st_num     | st_name |
+------------+---------+
| 2020123001 | 김영철  |
| 2020123002 | 나영희  |
| 2020160001 | 강철수  |
| 2020160002 | 박철수  |
| 2020456001 | 강군    |
+------------+---------+

mysql> show tables;
+-------------------+
| Tables_in_college |
+-------------------+
| 1_term_view       |
| attend            |
| course            |
| guide             |
| professor         |
| student           |
| subject           |
+-------------------+

show full tables; => 테이블 종류 확인가능
+-------------------+------------+
| Tables_in_college | Table_type |
+-------------------+------------+
| 1_term_view       | VIEW       |
| attend            | BASE TABLE |
| course            | BASE TABLE |
| guide             | BASE TABLE |
| professor         | BASE TABLE |
| student           | BASE TABLE |
| subject           | BASE TABLE |
+-------------------+------------+

=> view 내용 변경(변경x) (삭제 후 재생성)

create or replace view 1_term_view as
select distinct st_num, st_name
from student s
join attend a on a.at_st_num = s.st_num
join course c on a.at_co_num = c.co_num
where c.co_term = 1;

------------------------------------
school DB에서 view 생성
1. 컴퓨터공학과 (std_major) 뷰 생성 => com_view
  - 학번, 이름, 학과
create view com_view as
select std_num, std_name, std_major
from student
where std_major='컴퓨터공학';
mysql> select * from com_view;
+------------+----------+------------+
| std_num    | std_name | std_major  |
+------------+----------+------------+
| 2020160001 | 강철수   | 컴퓨터공학 |
| 2020160002 | 나영희   | 컴퓨터공학 |
| 2023160001 | 이영철   | 컴퓨터공학 |
+------------+----------+------------+

2. A학점인 친구들 뷰 생성 a_view
  - 학번, 이름, 학점
create view a_view as
select s.std_num, s.std_name, a.at_score
from student s
join attend a on a.at_std_num = s.std_num 
where a.at_score = 'A';

mysql> select * from a_view;
+------------+----------+----------+
| std_num    | std_name | at_score |
+------------+----------+----------+
| 2020160002 | 나영희   | A        |
| 2023160002 | 최수지   | A        |
+------------+----------+----------+

--view에도 where을 줄 수 있다.
select * from a_view
where std_num like '2020%';
-----------------------------------------------------

left join
--수강하지 않는 학생 검색 => 휴학생

student 테이블에 학생을 추가
insert into student values('2023160003','김영이','디자인',2,25);
insert into student values('2023160003','최영이','디자인',2,25);


=> student 테이블에는 존재하지만 attend 테이블에 없는 자료를 추출
select s.* from student s
left join attend a
on s.std_num = a.at_std_num
where a.at_num is null;

--------------------------------------------------
trigger : 트리거(연쇄반응)
테이블에 대한 이벤트(insert, update, delete)에 반응하여
자동으로 실행되는 작업
이벤트가 발생했을 때 데이터의 무결성(일관성)을 지키기 위해 사용

use testdb;
product / buy 테이블 이용

트리거 구문
drop trigger if exists 트리거명;
delimiter $$	=>  문장의 끝을 수정하는 키워드 ;  => $$  // 

create trigger 트리거명 after | before 이벤트 on 테이블명
for each now
begin
[트리거 시 실행될 구문 작성]
-- 변수 사용가능. (선언 방법)
declare 변수명 자료형 기본값;   _@ 특별한 기호를 이용하여 변수임을 알림
set 변수명 = 값;

-- new : 이벤트가 발생한 행의 최신 데이터
-- old : 이벤트가 발생하기 전의 데이터

end $$

delimiter ;	=> 원래대로 문장의 끝 기호를 수정

-- product 테이블에 amount(재고량)=100, sale_amount(판매량)=0 으로 변경.
update product set amount=100, sale_amount=0;
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
| num | type_a     | type_b       | name                | price | amount | sale_amount | register_date       |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
|   1 | 티셔츠     | 긴소매       | 폴라 티셔츠         | 15000 |    100 |           0 | 2023-10-15 00:00:00 |
|   2 | 티셔츠     | 긴소매       | 크롭 티셔츠         | 10000 |    100 |           0 | 2023-10-15 00:00:00 |
|   5 | 패션운동복 | 트레이닝상의 | 피트니스상의        | 30000 |    100 |           0 | 2023-12-05 00:00:00 |
|   6 | 패션운동복 | 트레이닝하의 | 피트니스하의        | 50000 |    100 |           0 | 2023-12-06 00:00:00 |
|   7 | 패션운동복 | 트레이닝세트 | 피트니스상하의      | 90000 |    100 |           0 | 2023-12-07 00:00:00 |
|   8 | 아우터     | 재킷         | 양면 롱 후리스 자켓 | 23300 |    100 |           0 | 2023-11-05 00:00:00 |
|   9 | 아우터     | 코트         | 양털 겨울 코트      | 50000 |    100 |           0 | 2023-10-31 00:00:00 |
|  10 | 아우터     | 코트         | 트렌치 코트         | 40000 |    100 |           0 | 2023-10-31 00:00:00 |
|  11 | 아우터     | 패딩         | 롱 패팅 점퍼        | 47400 |    100 |           0 | 2023-11-01 00:00:00 |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+

--buy 테이블에 insert가 되면 buy.amount만큼 product테이블의 amount -, sale_amount +

drop trigger if exists insert_buy;
delimiter $$
create trigger insert_buy after insert on buy
for each row
begin
  update product set 
  amount = amount - new.amount,
  sale_amount = sale_amount + new.amount 
  where name = new.product_name;
end $$
delimiter ;
-------------------------------------
안정성이 검증된 유저만 트리거, 프로시저, 함수를 사용할 수 있게 off
log_bin_trust_function_creators = off

show global variables like 'log_bin_trust_function_creators';
-- root계정에서 set
set global log_bin_trust_function_creators = on;

-----------------------------------
insert into buy(customer, product_name, price, amount)
values ('홍길동','폴라 티셔츠', 15000,10);

mysql> select * from buy;
+-----+----------+-------------------+-------+--------+--------+---------------------+
| num | customer | product_name      | price | amount | total  | buy_date            |
+-----+----------+-------------------+-------+--------+--------+---------------------+
|   1 | 홍길동   | 폴라 티셔츠       | 17000 |      5 |  85000 | 2024-08-29 10:54:43 |
|   2 | 홍길순   | 크롭 티셔츠       | 10000 |      3 |  30000 | 2024-08-29 10:58:52 |
|   3 | 김기태   | 순면라운드 반팔티 | 15900 |      1 |  15900 | 2024-08-29 11:02:56 |
|   4 | 홍기원   | 에이 나시         |  9000 |      3 |  27000 | 2024-08-29 11:02:56 |
|   5 | 하남일   | 피트니스상의      | 30000 |      7 | 210000 | 2024-08-29 11:02:56 |
|   6 | 송슬기   | 피트니스하의      | 50000 |      3 | 150000 | 2024-08-29 11:02:56 |
|   7 | 조아람   | 피트니스상하의    | 90000 |      2 | 180000 | 2024-08-29 11:02:57 |
|   8 | 조미란   | 순면라운드 반팔티 | 15900 |      4 |  63600 | 2024-08-29 11:04:30 |
|   9 | 전한결   | 피트니스상의      | 30000 |      2 |  60000 | 2024-08-29 11:05:37 |
|  10 | 장우람   | 피트니스하의      | 50000 |      1 |  50000 | 2024-08-29 11:05:37 |
|  11 | 고담비   | 피트니스상하의    | 90000 |      5 | 450000 | 2024-08-29 11:05:38 |
|  12 | 고윤서   | 피트니스상하의    | 90000 |      3 | 270000 | 2024-08-29 11:42:44 |
|  13 | 이시연   | 폴라 티셔츠       | 15000 |      2 |  30000 | 2024-08-29 15:06:20 |
|  14 | 채송화   | 에이 나시         |  9000 |      5 |  45000 | 2024-08-29 15:06:20 |
|  15 | 선아영   | 롱 패팅 점퍼      | 47400 |      1 |  47400 | 2024-08-29 15:06:21 |
|  16 | 홍길동   | 폴라 티셔츠       | 15000 |     10 | 150000 | 2024-09-02 16:48:51 |
+-----+----------+-------------------+-------+--------+--------+---------------------+

mysql> select * from product;
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
| num | type_a     | type_b       | name                | price | amount | sale_amount | register_date       |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
|   1 | 티셔츠     | 긴소매       | 폴라 티셔츠         | 15000 |     90 |          10 | 2023-10-15 00:00:00 |
|   2 | 티셔츠     | 긴소매       | 크롭 티셔츠         | 10000 |    100 |           0 | 2023-10-15 00:00:00 |
|   5 | 패션운동복 | 트레이닝상의 | 피트니스상의        | 30000 |    100 |           0 | 2023-12-05 00:00:00 |
|   6 | 패션운동복 | 트레이닝하의 | 피트니스하의        | 50000 |    100 |           0 | 2023-12-06 00:00:00 |
|   7 | 패션운동복 | 트레이닝세트 | 피트니스상하의      | 90000 |    100 |           0 | 2023-12-07 00:00:00 |
|   8 | 아우터     | 재킷         | 양면 롱 후리스 자켓 | 23300 |    100 |           0 | 2023-11-05 00:00:00 |
|   9 | 아우터     | 코트         | 양털 겨울 코트      | 50000 |    100 |           0 | 2023-10-31 00:00:00 |
|  10 | 아우터     | 코트         | 트렌치 코트         | 40000 |    100 |           0 | 2023-10-31 00:00:00 |
|  11 | 아우터     | 패딩         | 롱 패팅 점퍼        | 47400 |    100 |           0 | 2023-11-01 00:00:00 |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+

--재고가 10개 빠지고 판매가 10개 들어간 걸 볼 수 있다.

----------------------------------------------------

insert into buy(customer, product_name, price, amount)
values ('박순이','피트니스상의', 30000,7);
mysql> select * from buy;
+-----+----------+-------------------+-------+--------+--------+---------------------+
| num | customer | product_name      | price | amount | total  | buy_date            |
+-----+----------+-------------------+-------+--------+--------+---------------------+
|   1 | 홍길동   | 폴라 티셔츠       | 17000 |      5 |  85000 | 2024-08-29 10:54:43 |
|   2 | 홍길순   | 크롭 티셔츠       | 10000 |      3 |  30000 | 2024-08-29 10:58:52 |
|   3 | 김기태   | 순면라운드 반팔티 | 15900 |      1 |  15900 | 2024-08-29 11:02:56 |
|   4 | 홍기원   | 에이 나시         |  9000 |      3 |  27000 | 2024-08-29 11:02:56 |
|   5 | 하남일   | 피트니스상의      | 30000 |      7 | 210000 | 2024-08-29 11:02:56 |
|   6 | 송슬기   | 피트니스하의      | 50000 |      3 | 150000 | 2024-08-29 11:02:56 |
|   7 | 조아람   | 피트니스상하의    | 90000 |      2 | 180000 | 2024-08-29 11:02:57 |
|   8 | 조미란   | 순면라운드 반팔티 | 15900 |      4 |  63600 | 2024-08-29 11:04:30 |
|   9 | 전한결   | 피트니스상의      | 30000 |      2 |  60000 | 2024-08-29 11:05:37 |
|  10 | 장우람   | 피트니스하의      | 50000 |      1 |  50000 | 2024-08-29 11:05:37 |
|  11 | 고담비   | 피트니스상하의    | 90000 |      5 | 450000 | 2024-08-29 11:05:38 |
|  12 | 고윤서   | 피트니스상하의    | 90000 |      3 | 270000 | 2024-08-29 11:42:44 |
|  13 | 이시연   | 폴라 티셔츠       | 15000 |      2 |  30000 | 2024-08-29 15:06:20 |
|  14 | 채송화   | 에이 나시         |  9000 |      5 |  45000 | 2024-08-29 15:06:20 |
|  15 | 선아영   | 롱 패팅 점퍼      | 47400 |      1 |  47400 | 2024-08-29 15:06:21 |
|  16 | 홍길동   | 폴라 티셔츠       | 15000 |     10 | 150000 | 2024-09-02 16:48:51 |
|  17 | 박순이   | 피트니스상의      | 30000 |      7 | 210000 | 2024-09-02 16:51:15 |
+-----+----------+-------------------+-------+--------+--------+---------------------+
17 rows in set (0.00 sec)

mysql> select * from product;
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
| num | type_a     | type_b       | name                | price | amount | sale_amount | register_date       |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
|   1 | 티셔츠     | 긴소매       | 폴라 티셔츠         | 15000 |     90 |          10 | 2023-10-15 00:00:00 |
|   2 | 티셔츠     | 긴소매       | 크롭 티셔츠         | 10000 |    100 |           0 | 2023-10-15 00:00:00 |
|   5 | 패션운동복 | 트레이닝상의 | 피트니스상의        | 30000 |     93 |           7 | 2023-12-05 00:00:00 |
|   6 | 패션운동복 | 트레이닝하의 | 피트니스하의        | 50000 |    100 |           0 | 2023-12-06 00:00:00 |
|   7 | 패션운동복 | 트레이닝세트 | 피트니스상하의      | 90000 |    100 |           0 | 2023-12-07 00:00:00 |
|   8 | 아우터     | 재킷         | 양면 롱 후리스 자켓 | 23300 |    100 |           0 | 2023-11-05 00:00:00 |
|   9 | 아우터     | 코트         | 양털 겨울 코트      | 50000 |    100 |           0 | 2023-10-31 00:00:00 |
|  10 | 아우터     | 코트         | 트렌치 코트         | 40000 |    100 |           0 | 2023-10-31 00:00:00 |
|  11 | 아우터     | 패딩         | 롱 패팅 점퍼        | 47400 |    100 |           0 | 2023-11-01 00:00:00 |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+

--------------------------------------------------------------------------------

--trigger 적용이후에는 실행 안 됨. error
insert into buy(customer, product_name, price, amount)
select '박순이',name,price,6 from product
where num=11;

ERROR 1442 (HY000): Can't update table 'product' in stored function/trigger because it is already used by statement which invoked this stored function/trigger.

------------------------------------------------------------------------------------
buy 테이블에 데이터를 삭제하면 amount, sale_amount 변경
트리거 생성
delete 삭제 후 확인

-- 변수 사용
declare 변수명 자료형 기본값;
set 변수명 = 값;


drop trigger if exists del_buy;
delimiter $$
create trigger del_buy after delete on buy
for each row
begin
  declare _amount int default 0;
  set _amount = old.amount;

  update product set 
  amount = amount + _amount,
  sale_amount = sale_amount - _amount 
  where name = old.product_name;
end $$
delimiter ;

delete from buy where num= 1;
mysql> select * from buy;
+-----+----------+-------------------+-------+--------+--------+---------------------+
| num | customer | product_name      | price | amount | total  | buy_date            |
+-----+----------+-------------------+-------+--------+--------+---------------------+
|   2 | 홍길순   | 크롭 티셔츠       | 10000 |      3 |  30000 | 2024-08-29 10:58:52 |
|   3 | 김기태   | 순면라운드 반팔티 | 15900 |      1 |  15900 | 2024-08-29 11:02:56 |
|   4 | 홍기원   | 에이 나시         |  9000 |      3 |  27000 | 2024-08-29 11:02:56 |
|   5 | 하남일   | 피트니스상의      | 30000 |      7 | 210000 | 2024-08-29 11:02:56 |
|   6 | 송슬기   | 피트니스하의      | 50000 |      3 | 150000 | 2024-08-29 11:02:56 |
|   7 | 조아람   | 피트니스상하의    | 90000 |      2 | 180000 | 2024-08-29 11:02:57 |
|   8 | 조미란   | 순면라운드 반팔티 | 15900 |      4 |  63600 | 2024-08-29 11:04:30 |
|   9 | 전한결   | 피트니스상의      | 30000 |      2 |  60000 | 2024-08-29 11:05:37 |
|  10 | 장우람   | 피트니스하의      | 50000 |      1 |  50000 | 2024-08-29 11:05:37 |
|  11 | 고담비   | 피트니스상하의    | 90000 |      5 | 450000 | 2024-08-29 11:05:38 |
|  12 | 고윤서   | 피트니스상하의    | 90000 |      3 | 270000 | 2024-08-29 11:42:44 |
|  13 | 이시연   | 폴라 티셔츠       | 15000 |      2 |  30000 | 2024-08-29 15:06:20 |
|  14 | 채송화   | 에이 나시         |  9000 |      5 |  45000 | 2024-08-29 15:06:20 |
|  15 | 선아영   | 롱 패팅 점퍼      | 47400 |      1 |  47400 | 2024-08-29 15:06:21 |
|  16 | 홍길동   | 폴라 티셔츠       | 15000 |     10 | 150000 | 2024-09-02 16:48:51 |
+-----+----------+-------------------+-------+--------+--------+---------------------+
15 rows in set (0.00 sec)

mysql> select * from product;
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
| num | type_a     | type_b       | name                | price | amount | sale_amount | register_date       |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
|   1 | 티셔츠     | 긴소매       | 폴라 티셔츠         | 15000 |     95 |           5 | 2023-10-15 00:00:00 |
|   2 | 티셔츠     | 긴소매       | 크롭 티셔츠         | 10000 |    100 |           0 | 2023-10-15 00:00:00 |
|   5 | 패션운동복 | 트레이닝상의 | 피트니스상의        | 30000 |    100 |           0 | 2023-12-05 00:00:00 |
|   6 | 패션운동복 | 트레이닝하의 | 피트니스하의        | 50000 |    100 |           0 | 2023-12-06 00:00:00 |
|   7 | 패션운동복 | 트레이닝세트 | 피트니스상하의      | 90000 |    100 |           0 | 2023-12-07 00:00:00 |
|   8 | 아우터     | 재킷         | 양면 롱 후리스 자켓 | 23300 |    100 |           0 | 2023-11-05 00:00:00 |
|   9 | 아우터     | 코트         | 양털 겨울 코트      | 50000 |    100 |           0 | 2023-10-31 00:00:00 |
|  10 | 아우터     | 코트         | 트렌치 코트         | 40000 |    100 |           0 | 2023-10-31 00:00:00 |
|  11 | 아우터     | 패딩         | 롱 패팅 점퍼        | 47400 |    100 |           0 | 2023-11-01 00:00:00 |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+


-------------------------------------------------
buy 테이블의 데이터를 업데이트 하면
amount와 sale_amount 값 변경하는 트리거 작성

drop trigger if exists update_buy;
delimiter $$
create trigger update_buy after update on buy
for each row
begin
update product set
amount = amount + old.amount,
sale_amount = sale_amount - old.amount,
amount = amount - new.amount,
sale_amount = sale_amount + new.amount
where name = new.product_name;
end $$
delimiter ;

update buy set
amount = 10
where num = 16;
mysql> select * from buy;
+-----+----------+-------------------+-------+--------+--------+---------------------+
| num | customer | product_name      | price | amount | total  | buy_date            |
+-----+----------+-------------------+-------+--------+--------+---------------------+
|   2 | 홍길순   | 크롭 티셔츠       | 10000 |      3 |  30000 | 2024-08-29 10:58:52 |
|   3 | 김기태   | 순면라운드 반팔티 | 15900 |      1 |  15900 | 2024-08-29 11:02:56 |
|   4 | 홍기원   | 에이 나시         |  9000 |      3 |  27000 | 2024-08-29 11:02:56 |
|   5 | 하남일   | 피트니스상의      | 30000 |     20 | 600000 | 2024-08-29 11:02:56 |
|   6 | 송슬기   | 피트니스하의      | 50000 |      3 | 150000 | 2024-08-29 11:02:56 |
|   7 | 조아람   | 피트니스상하의    | 90000 |      2 | 180000 | 2024-08-29 11:02:57 |
|   8 | 조미란   | 순면라운드 반팔티 | 15900 |      4 |  63600 | 2024-08-29 11:04:30 |
|   9 | 전한결   | 피트니스상의      | 30000 |      2 |  60000 | 2024-08-29 11:05:37 |
|  10 | 장우람   | 피트니스하의      | 50000 |      1 |  50000 | 2024-08-29 11:05:37 |
|  11 | 고담비   | 피트니스상하의    | 90000 |      5 | 450000 | 2024-08-29 11:05:38 |
|  12 | 고윤서   | 피트니스상하의    | 90000 |      3 | 270000 | 2024-08-29 11:42:44 |
|  13 | 이시연   | 폴라 티셔츠       | 15000 |      2 |  30000 | 2024-08-29 15:06:20 |
|  14 | 채송화   | 에이 나시         |  9000 |      5 |  45000 | 2024-08-29 15:06:20 |
|  15 | 선아영   | 롱 패팅 점퍼      | 47400 |      1 |  47400 | 2024-08-29 15:06:21 |
|  16 | 홍길동   | 폴라 티셔츠       | 15000 |     10 | 150000 | 2024-09-02 16:48:51 |
+-----+----------+-------------------+-------+--------+--------+---------------------+
15 rows in set (0.00 sec)

mysql> select * from product;
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
| num | type_a     | type_b       | name                | price | amount | sale_amount | register_date       |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
|   1 | 티셔츠     | 긴소매       | 폴라 티셔츠         | 15000 |     95 |           5 | 2023-10-15 00:00:00 |
|   2 | 티셔츠     | 긴소매       | 크롭 티셔츠         | 10000 |    100 |           0 | 2023-10-15 00:00:00 |
|   5 | 패션운동복 | 트레이닝상의 | 피트니스상의        | 30000 |     87 |          13 | 2023-12-05 00:00:00 |
|   6 | 패션운동복 | 트레이닝하의 | 피트니스하의        | 50000 |    100 |           0 | 2023-12-06 00:00:00 |
|   7 | 패션운동복 | 트레이닝세트 | 피트니스상하의      | 90000 |    100 |           0 | 2023-12-07 00:00:00 |
|   8 | 아우터     | 재킷         | 양면 롱 후리스 자켓 | 23300 |    100 |           0 | 2023-11-05 00:00:00 |
|   9 | 아우터     | 코트         | 양털 겨울 코트      | 50000 |    100 |           0 | 2023-10-31 00:00:00 |
|  10 | 아우터     | 코트         | 트렌치 코트         | 40000 |    100 |           0 | 2023-10-31 00:00:00 |
|  11 | 아우터     | 패딩         | 롱 패팅 점퍼        | 47400 |    100 |           0 | 2023-11-01 00:00:00 |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
​

update buy set
amount = amount + 10
where num = 16;
mysql> select * from buy;
+-----+----------+-------------------+-------+--------+--------+---------------------+
| num | customer | product_name      | price | amount | total  | buy_date            |
+-----+----------+-------------------+-------+--------+--------+---------------------+
|   2 | 홍길순   | 크롭 티셔츠       | 10000 |      3 |  30000 | 2024-08-29 10:58:52 |
|   3 | 김기태   | 순면라운드 반팔티 | 15900 |      1 |  15900 | 2024-08-29 11:02:56 |
|   4 | 홍기원   | 에이 나시         |  9000 |      3 |  27000 | 2024-08-29 11:02:56 |
|   5 | 하남일   | 피트니스상의      | 30000 |     20 | 600000 | 2024-08-29 11:02:56 |
|   6 | 송슬기   | 피트니스하의      | 50000 |      3 | 150000 | 2024-08-29 11:02:56 |
|   7 | 조아람   | 피트니스상하의    | 90000 |      2 | 180000 | 2024-08-29 11:02:57 |
|   8 | 조미란   | 순면라운드 반팔티 | 15900 |      4 |  63600 | 2024-08-29 11:04:30 |
|   9 | 전한결   | 피트니스상의      | 30000 |      2 |  60000 | 2024-08-29 11:05:37 |
|  10 | 장우람   | 피트니스하의      | 50000 |      1 |  50000 | 2024-08-29 11:05:37 |
|  11 | 고담비   | 피트니스상하의    | 90000 |      5 | 450000 | 2024-08-29 11:05:38 |
|  12 | 고윤서   | 피트니스상하의    | 90000 |      3 | 270000 | 2024-08-29 11:42:44 |
|  13 | 이시연   | 폴라 티셔츠       | 15000 |      2 |  30000 | 2024-08-29 15:06:20 |
|  14 | 채송화   | 에이 나시         |  9000 |      5 |  45000 | 2024-08-29 15:06:20 |
|  15 | 선아영   | 롱 패팅 점퍼      | 47400 |      1 |  47400 | 2024-08-29 15:06:21 |
|  16 | 홍길동   | 폴라 티셔츠       | 15000 |     20 | 300000 | 2024-09-02 16:48:51 |
+-----+----------+-------------------+-------+--------+--------+---------------------+
15 rows in set (0.00 sec)

mysql> select * from product;
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
| num | type_a     | type_b       | name                | price | amount | sale_amount | register_date       |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+
|   1 | 티셔츠     | 긴소매       | 폴라 티셔츠         | 15000 |     85 |          15 | 2023-10-15 00:00:00 |
|   2 | 티셔츠     | 긴소매       | 크롭 티셔츠         | 10000 |    100 |           0 | 2023-10-15 00:00:00 |
|   5 | 패션운동복 | 트레이닝상의 | 피트니스상의        | 30000 |     87 |          13 | 2023-12-05 00:00:00 |
|   6 | 패션운동복 | 트레이닝하의 | 피트니스하의        | 50000 |    100 |           0 | 2023-12-06 00:00:00 |
|   7 | 패션운동복 | 트레이닝세트 | 피트니스상하의      | 90000 |    100 |           0 | 2023-12-07 00:00:00 |
|   8 | 아우터     | 재킷         | 양면 롱 후리스 자켓 | 23300 |    100 |           0 | 2023-11-05 00:00:00 |
|   9 | 아우터     | 코트         | 양털 겨울 코트      | 50000 |    100 |           0 | 2023-10-31 00:00:00 |
|  10 | 아우터     | 코트         | 트렌치 코트         | 40000 |    100 |           0 | 2023-10-31 00:00:00 |
|  11 | 아우터     | 패딩         | 롱 패팅 점퍼        | 47400 |    100 |           0 | 2023-11-01 00:00:00 |
+-----+------------+--------------+---------------------+-------+--------+-------------+---------------------+



